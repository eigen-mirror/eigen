# Upload docs if pipeline succeeded.
deploy:docs:
  stage: deploy
  image: busybox
  dependencies: [ build:linux:docs ]
  variables:
    PAGES_PREFIX: docs-nightly
  script:
    - echo "Deploying site to $CI_PAGES_URL"
    - mv ${EIGEN_CI_BUILDDIR}/doc/html public
  pages:
    path_prefix: $PAGES_PREFIX
    expire_in: never
  artifacts:
    name: "$CI_JOB_NAME_SLUG-$CI_COMMIT_REF_SLUG"
    paths:
      - public
  tags:
    - saas-linux-small-amd64
  rules:
    - if: $CI_PIPELINE_SOURCE == "schedule" && $CI_PROJECT_NAMESPACE == "libeigen"
    - if: $CI_PIPELINE_SOURCE == "web" && $CI_PROJECT_NAMESPACE == "libeigen"
    - if: $CI_PIPELINE_SOURCE == "push" && $CI_PROJECT_NAMESPACE == "libeigen"
      variables:
        PAGES_PREFIX: docs-$CI_COMMIT_REF_NAME
